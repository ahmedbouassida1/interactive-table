<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Matrice des Privilèges et Accès des Acteurs</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'DM Sans', sans-serif;
            background-color: #e6fafe; /* Updated page background color */
            padding: 1.5rem;
        }
        .tab-active {
            background-color: #4338ca;
            color: white;
        }
        .sub-tab-active {
            border-bottom: 2px solid #4f46e5;
            color: #4f46e5;
        }
        .table-header-text {
            color: #333365;
        }
        /* Updated table row separator color */
        .divide-y > :not([hidden]) ~ :not([hidden]) {
            border-color: #d9d9fe;
        }
    </style>
</head>
<body>
    <div id="privilege-matrix" class="max-w-5xl mx-auto bg-white rounded-xl shadow-lg overflow-hidden">
        <div class="p-6 sm:p-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-indigo-700 mb-2">Tableau des Privilèges et Accès</h1>
            <p class="text-gray-500">Naviguez entre les acteurs et les plateformes pour voir les permissions.</p>
        </div>

        <!-- Main Actor Tabs -->
        <div class="px-6 sm:px-8 border-b border-gray-200">
            <nav id="main-tabs" class="flex flex-wrap -mb-px" aria-label="Tabs">
                <!-- Actor tabs will be inserted here by JavaScript -->
            </nav>
        </div>

        <!-- Content Area -->
        <div id="tab-content" class="p-6 sm:p-8">
            <!-- Actor-specific content will be rendered here -->
        </div>
    </div>

    <footer class="text-center mt-8 text-sm text-gray-500">
        <p>&copy; 2025 iLocker Tunisie. Tous droits réservés.</p>
        <a href="https://ilocker.com.tn" target="_blank" rel="noopener noreferrer" class="text-indigo-600 hover:underline">ilocker.com.tn</a>
    </footer>

    <script>
        // --- Master Lists of Functionalities for Consistency ---
        const webFunctionalities = [
            "Authentification (Web)",
            "Gestion des Utilisateurs",
            "Visualisation Géolocalisée Appareils",
            "Planification Interventions",
            "Supervision Interventions",
            "Attribuer des interventions",
            "Consultation Historique Interventions",
            "Export Rapports Interventions",
            "Notifications & Alertes (Web)",
            "Création/Approbation Actualités",
            "Reporting",
            "Enregistrement des chauffe-eaux fabriqués",
            "Déclaration des ventes"
        ];

        const mobileFunctionalities = [
            "Authentification (Mobile)",
            "Notifications & Alertes (Mobile)",
            "Consultation Actualités (Mobile)",
            "Enregistrement Appareils",
            "Exécution Interventions",
            "Suivi détaillé Interventions",
            "Scan de QR Code",
            "Consultation Historique Interventions (Mobile)",
            "Déclaration des Ventes"
        ];

        // --- Data structure for actors and their permissions ---
        const actors = {
            "ANME": {
                web: {
                    "Authentification (Web)": true,
                    "Visualisation Géolocalisée Appareils": true,
                    "Supervision Interventions": false,
                },
                mobile: {
                    "Authentification (Mobile)": true,
                    "Notifications & Alertes (Mobile)": true,
                    "Enregistrement Appareils": true,
                }
            },
            "Usine": {
                web: {
                    "Authentification (Web)": true,
                    "Enregistrement des chauffe-eaux fabriqués": true,
                    "Reporting": true,
                },
                mobile: {}
            },
            "Administrateur Système": {
                web: {
                    "Authentification (Web)": true,
                    "Gestion des Utilisateurs": true,
                    "Planification Interventions": true,
                    "Supervision Interventions": true,
                    "Déclaration des ventes": true,
                    "Reporting": true,
                    "Attribuer des interventions": true,
                    "Consultation Historique Interventions": true,
                    "Export Rapports Interventions": true,
                    "Notifications & Alertes (Web)": true,
                },
                mobile: {
                    "Authentification (Mobile)": true,
                    "Notifications & Alertes (Mobile)": true,
                    "Enregistrement Appareils": true,
                    "Déclaration des Ventes": true,
                }
            },
            "Installateur Agréé": {
                web: {
                    "Authentification (Web)": true,
                    "Visualisation Géolocalisée Appareils": true,
                    "Planification Interventions": true,
                    "Supervision Interventions": false,
                    "Consultation Historique Interventions": true,
                    "Export Rapports Interventions": true,
                    "Notifications & Alertes (Web)": true,
                    "Création/Approbation Actualités": true,
                    "Déclaration des ventes": true,
                },
                mobile: {
                    "Authentification (Mobile)": true,
                    "Exécution Interventions": true,
                    "Suivi détaillé Interventions": true,
                    "Scan de QR Code": true,
                    "Consultation Historique Interventions (Mobile)": true,
                    "Notifications & Alertes (Mobile)": true,
                    "Consultation Actualités (Mobile)": true,
                    "Déclaration des Ventes": true,
                }
            },
            "Réparateur Agréé": {
                web: {
                    "Authentification (Web)": true,
                    "Visualisation Géolocalisée Appareils": true,
                    "Planification Interventions": true,
                    "Supervision Interventions": false,
                    "Consultation Historique Interventions": true,
                    "Export Rapports Interventions": true,
                    "Notifications & Alertes (Web)": true,
                    "Création/Approbation Actualités": true,
                },
                mobile: {
                    "Authentification (Mobile)": true,
                    "Exécution Interventions": true,
                    "Suivi détaillé Interventions": true,
                    "Scan de QR Code": true,
                    "Consultation Historique Interventions (Mobile)": true,
                    "Notifications & Alertes (Mobile)": true,
                    "Consultation Actualités (Mobile)": true,
                    "Déclaration des Ventes": false,
                }
            }
        };

        const mainTabsContainer = document.getElementById('main-tabs');
        const contentContainer = document.getElementById('tab-content');
        let activeActor = Object.keys(actors)[0];
        let activePlatform = 'web';
        let sortOrder = 'none'; // 'none', 'desc' (valid first), 'asc' (invalid first)

        function renderContent() {
            const actorPermissions = actors[activeActor][activePlatform];
            let masterList = [...(activePlatform === 'web' ? webFunctionalities : mobileFunctionalities)];

            // Sorting logic
            if (sortOrder !== 'none') {
                masterList.sort((a, b) => {
                    const accessA = actorPermissions[a] || false;
                    const accessB = actorPermissions[b] || false;
                    if (sortOrder === 'desc') {
                        return (accessB - accessA); // true (1) comes before false (0)
                    } else {
                        return (accessA - accessB); // false (0) comes before true (1)
                    }
                });
            }

            const subTabsHTML = `
                <div class="border-b border-gray-200 mb-6">
                    <nav class="flex space-x-4" aria-label="Sub-tabs">
                        <button onclick="setPlatform('web')" class="sub-tab ${activePlatform === 'web' ? 'sub-tab-active' : 'text-gray-500 hover:text-gray-700'} px-3 py-2 font-medium text-sm rounded-t-md">Web</button>
                        <button onclick="setPlatform('mobile')" class="sub-tab ${activePlatform === 'mobile' ? 'sub-tab-active' : 'text-gray-500 hover:text-gray-700'} px-3 py-2 font-medium text-sm rounded-t-md">Mobile</button>
                    </nav>
                </div>
            `;

            let tableHTML = '<p class="text-gray-500">Aucune fonctionnalité pour cette plateforme.</p>';
            if (masterList.length > 0) {
                tableHTML = `
                    <div class="overflow-x-auto">
                        <table class="min-w-full">
                            <thead class="bg-indigo-50">
                                <tr>
                                    <th scope="col" class="table-header-text px-6 py-3 text-left text-sm font-semibold uppercase tracking-wider">Fonctionnalité</th>
                                    <th scope="col" class="px-6 py-3 text-center text-sm font-semibold uppercase tracking-wider">
                                        <div class="table-header-text flex items-center justify-center space-x-2">
                                            <span>Accès</span>
                                            <button id="sort-button" class="p-1 rounded-full hover:bg-indigo-200">
                                                <svg class="w-4 h-4" style="color: #333365;" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 9l4-4 4 4m0 6l-4 4-4-4"></path></svg>
                                            </button>
                                        </div>
                                    </th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y">
                                ${masterList.map(featureName => {
                                    const hasAccess = actorPermissions[featureName] || false;
                                    return `
                                        <tr>
                                            <td class="px-6 py-4 whitespace-nowrap text-base font-medium text-gray-800">${featureName}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-center">
                                                ${hasAccess 
                                                    ? '<span class="text-green-600 font-bold text-2xl">✓</span>' 
                                                    : '<span class="text-red-500 font-bold text-2xl">✗</span>'}
                                            </td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            }
            contentContainer.innerHTML = subTabsHTML + tableHTML;
            renderMainTabs();
            
            // Add event listener to the new sort button
            document.getElementById('sort-button').addEventListener('click', () => {
                if (sortOrder === 'none') {
                    sortOrder = 'desc';
                } else if (sortOrder === 'desc') {
                    sortOrder = 'asc';
                } else {
                    sortOrder = 'none';
                }
                renderContent();
            });
        }
        
        function renderMainTabs() {
            mainTabsContainer.innerHTML = Object.keys(actors).map(actorName => `
                <button onclick="setActor('${actorName}')" class="main-tab ${activeActor === actorName ? 'tab-active' : 'text-gray-600 hover:bg-gray-100'} text-sm font-medium text-center py-3 px-4 rounded-t-lg transition-colors duration-200">
                    ${actorName.replace(/_/g, ' ')}
                </button>
            `).join('');
        }

        window.setActor = function(actorName) {
            activeActor = actorName;
            activePlatform = 'web';
            sortOrder = 'none'; // Reset sort when changing actor
            renderContent();
        }

        window.setPlatform = function(platformName) {
            activePlatform = platformName;
            sortOrder = 'none'; // Reset sort when changing platform
            renderContent();
        }

        renderContent();
    </script>
</body>
</html>
